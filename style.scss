// /r/KotakuInAction CSS v0.1 by spooc
$version: "1.0";

$production: false !default !global;

@function asset_url($asset_id, $extension) {
  @if ($production == true) {
    @return '%%' + $asset_id + '%%';
  } @else {
    @return 'assets/' + $asset_id + '.' + $extension;
  }
}

// ********* Assets. ********* //
$asset_comment: asset_url('comment', 'png');
$asset_comment_nm: asset_url('comment-nm', 'png');
$asset_nm_sun: asset_url('icon-nm-sun', 'png');
$asset_nm_moon: asset_url('icon-nm-moon', 'png');
$asset_icon_main_cntrv: asset_url('icon-main-cntrv', 'png');
$asset_icon_main_glided: asset_url('icon-main-glided', 'png');
$asset_icon_main_hot: asset_url('icon-main-hot', 'png');
$asset_icon_main_new: asset_url('icon-main-new', 'png');
$asset_icon_main_rising: asset_url('icon-main-rising', 'png');
$asset_icon_main_top: asset_url('icon-main-top', 'png');
$asset_logo: asset_url('logo', 'png');
$asset_logo_sr: asset_url('logo-sr', 'png');
$asset_mars_top: asset_url('mars-top', 'png');
$asset_mars_btm: asset_url('mars-btm', 'jpg');
$asset_texture: asset_url('texture', 'png');
$asset_toolbox_edit: asset_url('toolbox-edit', 'png');
$asset_vivian_search: asset_url('vivian-search', 'png');
$asset_vivian_night: asset_url('vivian-night', 'png');
$asset_vote_up: asset_url('vote-up', 'png');
$asset_vote_down: asset_url('vote-down', 'png');

// ********* Typography configuration. ********* //
$font-size-focus: 12px;   // General font size for text that should be in focus.
$font-size-blur: 10px;    // Small font size for text that should not be in focus
                          // and is very likely to not be interesting for user.
$font-size-btn: 14px;     // Button font sizes.

$font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;

// ********* Color configuration. ********* //
$color-focus-fill: #fff;
$color-focus-fill2: #f8f8f8;
$color-focus-fill3: #ccc;
$color-focus-bg: #eee;
$color-focus-fg: #333;
$color-focus-border: #e2e2e2;

$color-blur-bg: #333;
$color-blur-fg: #aaa;
$color-blur-border: #aaa;

$color-alert-fg: #f33;

$color-upvote: #33b515;
$color-downvote: #8e1dc9;

$nm-brightness: 70%;
$nm-general-opacity: $nm-brightness / 100%;
$nm-darken-factor: 100% - $nm-brightness;

@function nm_darken($color, $factor:100%) {
  @return darken($color, $nm-darken-factor * ($factor / 100%));
}

$nm-link-color: lighten(#14ce1a, $nm-darken-factor);
$nm-link-color-visited: lighten(#d803ff, $nm-darken-factor * .75);

// ********* Size configuration. ********* //
$full_min_width: 800px;   // Minimum width screen we support without scrollbar.
$left-gutter-width: 60px; // The left gutter is where the upvotes and downvotes are.
                          // This is the first clear "column" in the grid.

$srarea-height: 19px;     // Subreddit area height. The first row.
$logoarea-height: 75px;  // Logo area height. The second row.
$logoarea-gutter: 140px;  // Logo area gutter that makes room for the logo.

$linkbar-height: 24px;    // Linkbar area height. The third row.
$linkbar-top: ($srarea-height + $logoarea-height);

$sidebar-padding: 10px;
$sidebar-inner-width: 300px;
$sidebar-top: ($linkbar-top + $linkbar-height);
$sidebar-width: ($sidebar-padding * 2 + $sidebar-inner-width);

$tabmenu-inner-height: 28px;
$tabmenu-pad: 4px;
$tabmenu-cat-margin: 12px;
$tabmenu-height: ($tabmenu-pad + $tabmenu-inner-height + $tabmenu-pad);
$tabmenu-min-width: ($full_min_width - $sidebar-width);
$tabmenu-tag-filter-btn-width: 105px; // First button in tabmenu.

$res-navtop-right: 90px;

// ********* Media queries. ********* //

$respond-min-hgalign: 880px + $logoarea-gutter; // 1. Below this screen size and we stop gutter aligning header.
$respond-min-sidelvl: $respond-min-hgalign - $left-gutter-width - $logoarea-gutter + $sidebar_padding;
                             // 2. Below this screen size we disable the sidebar injecting
                             //    itself upwards and position search in header.
$respond-min-sidebar: 540px; // 3. Below this screen size we cannot have a sidebar anymore.

$mexpr-phone: "only screen and (min-device-width: 320px) and (max-device-width: 480px)";
$mexpr-not-phone: "(min-device-width: 481px)";

// ********* Tag color configuration. ********* //
$tag_color_unverified: #e01919;
$tag_color_rumor: #455184;
$tag_color_verified: #13e800;
$tag_color_people: #1a80ed;
$tag_color_happenings: #ed871a;
$tag_color_ideas: #828282;
$tag_color_goal: #aa10de;
$tag_color_editorial: #dbc200;
$tag_color_meta: #088a85;
$tag_color_drama: #ff24c8;
$tag_color_humor: #543e00;
$tag_color_showerthought: #3be0f2;
$tag_color_discussion: #1c9328;
$tag_color_off_topic: #5600bf;
$tag_color_ethics: #9e0000;
$tag_color_industry: #b1af9c;
$tag_color_censorship: #000000;
$tag_color_socjus: #faaafa;

$side_header_color: #888;
$side_header_font_size: 16px;

@mixin reset-box {
  display: block;
  position: static;
  width: auto;
  height: auto;
  margin: 0px;
  padding: 0px;
  border: 0px none transparent;
  border-radius: 0px;
  background-color: transparent;
}

@mixin reset-text {
  font-family: inherit;
  font-size: inherit;
  font-weight: normal;
  letter-spacing: normal;
  line-height: normal;
  text-transform: none;
}

@mixin font-focus {
  @include reset-text;
  color: $color-focus-fg;
  font-size: $font-size-focus;

  .res-nightmode & {
    color: nm_darken($color-focus-fill);
  }
}

@mixin font-blur {
  @include reset-text;
  color: $color-blur-fg;
  font-size: $font-size-blur;

  .res-nightmode & {
    color: nm_darken($color-focus-fill3);
  }
}

@mixin font-form-field {
  @include font-focus;
  color: $color-focus-fg;
  font-size: $font-size-btn;
}

@mixin focus-fill {
  background-color: $color-focus-fill;
  .res-nightmode & {
    background-color: darken($color-focus-fill, 85%);
  }
}

@mixin focus-fill2 {
  background-color: $color-focus-fill2;
  .res-nightmode & {
    background-color: darken($color-focus-fill2, 85%);
  }
}

@mixin focus-fill3 {
  background-color: $color-focus-fill3;
  .res-nightmode & {
    background-color: darken($color-focus-fill3, 85%);
  }
}


@mixin focus {
  @include focus-fill;
  color: $color-focus-fg;
  font-size: $font-size-focus;

  .res-nightmode & {
    color: nm_darken($color-focus-fill);
    border-color: darken($color-focus-border, 83%);
  }
}

@mixin focus-box {
  border: 1px solid $color-focus-border;
  @include focus;
}

@mixin form-field-box {
    @include focus-box;
    border-width: 3px;
    border-radius: 5px;

    border-color: $color-focus-fill3;
    .res-nightmode & {
      background-color: darken($color-focus-fill3, 85%);
    }
}


@mixin focus-bg {
  background-color: $color-focus-bg;
  .res-nightmode & {
    background-color: darken($color-focus-bg, 85%);
  }
}

@mixin blur {
  color: $color-blur-fg;
  border-color: $color-blur-border;
  font-size: $font-size-blur;

  .res-nightmode & {
    color: nm_darken($color-blur-fg);
    border-color: darken($color-blur-border, 50%);
  }
}

@mixin nm-opacity($opacity) {
  .res-nightmode & {
    opacity: $opacity;
  }
}

@mixin nm-low-opacity {
  @include nm-opacity($nm-general-opacity);
}

// Mixin for reddit site content.
// We tone this content down with dark colors to remove distractions.
@mixin reddit-site {
  @include reset-text;
  @include blur;
  background-color: $color-blur-bg;
  .res-nightmode & {
    background-color: darken($color-focus-bg, 90%);
  }
}

@mixin reddit-srarea {
  @include reddit-site;
  @include font-blur;
  line-height: $srarea-height;
}

// Bootstrap flat button.
$btn-border: 1px;
$btn-padding: 12px;
@mixin btn {
  display: inline-block;
  padding: ($btn-padding / 2) $btn-padding;
  margin-bottom: 0;
  font-size: $font-size-btn;
  font-weight: normal;
  height: auto;
  line-height: normal;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  cursor: pointer;
  background-image: none;
  border: $btn-border solid transparent;
  border-radius: 4px;
}


@mixin button-variant-raw($fg, $bg, $bd) {

  // Important for RES.
  color: $fg !important;
  background-color: $bg;
  border-color: $bd;

  &:focus,
  &.focus {
    background-color: darken($bg, 10%);
        border-color: darken($bd, 25%);
  }
  &:hover {
    background-color: darken($bg, 10%);
        border-color: darken($bd, 12%);
  }
  &:active & {
    background-color: darken($bg, 10%);
        border-color: darken($bd, 12%);
  }
}

@mixin button-variant-nmc($fg, $bg, $bd, $fgo, $bgo, $bdo) {
  @include button-variant-raw($fg, $bg, $bd);
  .res-nightmode & {
    @include button-variant-raw(nm_darken($fg, $fgo), nm_darken($bg, $bgo), nm_darken($bd, $bdo));
  }
}


@mixin button-variant($fg, $bg, $bd) {
  @include button-variant-nmc($fg, $bg, $bd, 45%, 25%, 20%);
}

// Bootstrap flat default button.
@mixin btn-default {
  @include btn;
  @include button-variant-nmc(#333, #fff, #ccc, 100%, 75%, 60%);

  .res-nightmode & {
    @include button-variant-nmc(#b3b3b3, #1f1f1f, #000, 100%, 75%, 60%);
  }
}

// Bootstrap flat primary button.
@mixin btn-primary {
  @include btn;
  @include button-variant(#fff, #7a33b7, #6d2ea4);
}

// Bootstrap flat success button.
@mixin btn-success {
  @include btn;
  @include button-variant(#fff, #5cb85c, #4cae4c);
}

// Bootstrap btn-sm.
@mixin btn-sm {
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 3px;
}

@mixin big-sidebar-btn {
  @include border-box;
  padding-left: 0px;
  padding-right: 0px;
  height: 41px;
  font-size: 16px;
  line-height: 29px;
}

// Brute force hiding of text.
@mixin hide-text {
  font-size: 0;
  color: transparent;
  text-indent: -9999px;
  overflow: hidden;
}

@mixin btn-tabmenu-dim {
  display: inline-block;
  padding-top: 0px;
  padding-bottom: 0px;
  $inner-height: $tabmenu-inner-height - $btn-border * 2;
  height: $inner-height;
  line-height: $inner-height;
}

@mixin icon-tabmenu-custom($icon_url) {
  @include btn-tabmenu-dim;
  padding: 0px;
  position: relative;
  width: $tabmenu-inner-height - $btn-border * 2;

  &::before {
    content: ' ';
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    background-image: url($icon_url);
    background-repeat: no-repeat;
    background-size: $tabmenu-inner-height - $btn-border * 8;
    background-position: ($btn-border * 3) ($btn-border * 3);
    @include nm-low-opacity;
  }
}

@mixin icon-tabmenu($icon_url) {
  @include hide-text;
  @include icon-tabmenu-custom($icon_url);
}

@-webkit-keyframes show_on_100 {
  0% {
    opacity: 0;
  }
  99% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
@keyframes show_on_100 {
  0% {
    opacity: 0;
  }
  99% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}

@mixin tooltip($text) {
  position: relative;

  &:after {
    content: $text;
    text-transform: none;
    padding: 2px;
    display: none;
    position: absolute;
    top: 105%;
    left: 25%;
    width: auto;
    color: $color-focus-fg;
    font-size: $font-size-focus;
    line-height: $font-size-focus;
    font-weight: normal;
    background-color: #fef4c5;
    border: 1px solid #d4b943;
    -moz-border-radius: 2px;
    -webkit-border-radius: 2px;
    -ms-border-radius: 2px;
    border-radius: 2px;
  }
  &:hover:after {
    display: inline-block;

    -webkit-animation: show_on_100 0.4s forwards;
    -webkit-animation-iteration-count: 1;
    -webkit-animation-delay: 0s;
    animation: show_on_100 0.4s forwards;
    animation-iteration-count: 1;
    animation-delay: 0s;
  }
}


@mixin link-flair-base {
  @include focus-box;
  @include focus-fill2;
  font-size: 10px;
  line-height: normal;
  display: inline-block;
  padding: 1px;
  height: 12px;
  max-height: 15px;
  border: 1px solid #ddd;
  border-radius: 0px;
  margin-right: 5px;
}

// Standard link flairs have fixed lengths.
@mixin std-link-flair($color) {
  background-color: $color;
  color: $color-focus-fill;
  text-align: center;
  width: 70px;

  .res-nightmode & {
    color: nm_darken($color-focus-fill);
    background-color: nm_darken($color, 100%);
    border-color: nm_darken($color-focus-fill3);
  }
}

@mixin content-title {
  /*
  > a:first-child {
    // Has no category yet, show temporary flair.
    &::before {
      @include std-link-flair(#b0b0b0);
      font-size: 10px;
      content: 'NO TAG';
      opacity: .2;
      color: #000;
      position: relative;
      top: -.25em;
    }
  }*/
  @at-root .linkflairlabel {
    @include link-flair-base;
    position: relative;
    top: .3em;

    .linkflair-unverified & {
      @include std-link-flair($tag_color_unverified);
    }
    .linkflair-rumor & {
      @include std-link-flair($tag_color_rumor);
    }
    .linkflair-verified & {
      @include std-link-flair($tag_color_verified);
    }
    .linkflair-people & {
      @include std-link-flair($tag_color_people);
    }
    .linkflair-happenings & {
      @include std-link-flair($tag_color_happenings);
    }
    .linkflair-ideas & {
      @include std-link-flair($tag_color_ideas);
    }
    .linkflair-goal & {
      @include std-link-flair($tag_color_goal);
    }
    .linkflair-editorial & {
      @include std-link-flair($tag_color_editorial);
    }
    .linkflair-meta & {
      @include std-link-flair($tag_color_meta);
    }
    .linkflair-drama & {
      @include std-link-flair($tag_color_drama);
    }
    .linkflair-humor & {
      @include std-link-flair($tag_color_humor);
    }
    .linkflair-showerthought & {
      @include showerthought-flair;
    }
    .linkflair-discussion & {
      @include std-link-flair($tag_color_discussion);
    }
    .linkflair-off-topic & {
      @include std-link-flair($tag_color_off_topic);
    }
    .linkflair-ethics & {
      @include std-link-flair($tag_color_ethics);
    }
    .linkflair-industry & {
      @include std-link-flair($tag_color_industry);
    }
    .linkflair-socjus & {
      @include std-link-flair($tag_color_socjus);
      color: black;
    }
    .linkflair-censorship & {
      @include std-link-flair($tag_color_censorship);
      text-decoration: line-through;
    }
  }
}

// This flair has hack that shortens the excessive length.
@mixin showerthought-flair {
  @include std-link-flair($tag_color_showerthought);

  // Tag is too long, shorten it.
  max-width: none;
  font-size: 0px;
  &::after {
    content: 'SHOWERTH.';
    font-size: 10px;
  }
}

@mixin box-shadow($x, $y, $br, $sr, $color) {
  -webkit-box-shadow: $x $y $br $sr $color;
  -moz-box-shadow: $x $y $br $sr $color;
  box-shadow: $x $y $br $sr $color;
}

@mixin border-box {
  -webkit-box-sizing: border-box;
     -moz-box-sizing: border-box;
          box-sizing: border-box;
}

@mixin main-box-shadow {
  @include box-shadow(-10px, 15px, 15px, 0px, rgba(0, 0, 0, 0.4));
}

// Nightmode hacks.
.res-nightmode {
  // !important because of RES.
  a, .thing .title a {
    color: nm_darken($nm-link-color) !important;
  }
  a:visited, .thing.visited .title a {
    color: nm_darken($nm-link-color-visited) !important;
  }
  // RES overrides.
  .RES-keyNav-activeElement {
    background-color: #373737 !important;

    .title a {
      color: #fff !important;
    }
  }

  // Just lower opacity of things that is to tedius to adjust color of.
  .midcol > div, div.expando-button,
  div.thing p.title a:first-child::before {
    opacity: $nm-general-opacity;
  }
}

// General upvote/downvote style.
.midcol {
  > .score.likes {
    color: $color-upvote;
  }
  > .score.dislikes {
    color: $color-downvote;
  }
  div.upmod {
    background-image: url($asset_vote_up);
    background-position: 0px 0px;
  }
  div.downmod {
    background-image: url($asset_vote_down);
    background-position: 0px 0px;
  }
}

// General thing style.
div.thing {
  div.entry {
    > p.title {
      > span.domain {
        @include font-blur;
        a {
          @include font-blur;
        }
      }
    }
    > p.tagline {
      @include font-blur;
    }
    // Make action list much more compact.
    > ul.flat-list {
      font-size: 0px;
      li {
        padding: 0px;
        @include font-blur;
        a {
          @include font-blur;
        }
        &:nth-child(n + 2) {
          padding-left: 6px;
        }
      }
      a {
        padding: 0px;
      }
      // Highlight comments link.
      a.comments {
        @include font-focus;
      }
      // Highlight reply link.
      a[onclick^='return reply'] {
        @include font-focus;
      }
    }
  }

  p.title {
    overflow: visible;
  }
}

// Reset weird coloring rule in reddit stylesheet.
.titlebox h1 a {color: #0079d3;}

// General markdown style.
div.md {
  @include font-focus;

  h1, h2, h3, h4, h5, h6 {
    line-height: 1em;
    margin: 0.25em 0;
    text-transform: uppercase;
  }

  h1 {
    font-size: 2em;
  }

  h2 {
    font-size: 1.75em;
  }

  h3 {
    font-size: 1.5em;
  }

  h4 {
    font-size: 1.25em;
  }

  h5 {
    font-size: 1em;
  }

  h6 {
    font-size: .5em;
  }

  .-lists, ul, ol {
    padding-left: 2em;
  }

  .res-nightmode & {

    blockquote, del {
      color: nm_darken(#ccc);
    }

    code, pre {
      color: nm_darken(#eee);
      background-color: nm_darken(#878787);
      border-color: black;
    }
  }
}

// Markdown editor style.
html.res {
}

// This fixes some issues with reddit companion.
html {
	position: relative;
}

// Header image and area.
#header {

  // !important for RES.
  background-color: transparent !important;

  border: none;
  // The header pushes the main content and sidebar down under the tabmenu with bottom margin.
  // The reason why the height is not used is because it would otherwise cover the search field.
  // The sidebar is then pushed up the same distance with the magic of negative margins
  // to place itself to the right of the tabmenu. Technically we use padding
  // in favor of margin because it will allow us to use `overflow: hidden` for
  // artistic logo placement.
  padding-bottom: $sidebar-top + $tabmenu-height;
  height: 0px;
  overflow: hidden;

  // Fixes sr dropdown under filter by tag, etc.
  z-index: 1000;

  #sr-header-area {
    @include reddit-srarea;
    a, span {
      @include reddit-srarea;
    }
    div.sr-list, div.srdrop span {
      line-height: $srarea-height;
    }


    opacity: 0.3;
    &:hover {
      opacity: 1;
    }
  }
}

#header-bottom-left {
  // We cannot let this element cover the entire page as it would otherwise cover the search
  // field in lower resolutions, so we make it the maximum possible size instead.
  width: ($tabmenu-min-width - $left-gutter-width);
  height: $logoarea-height;
  line-height: 0px;
  overflow: hidden;

  // Gutter align unless screen is too small.
  margin-left: $sidebar-padding;
  @media only screen and (min-width: $respond-min-hgalign) {
    margin-left: 200px;
  }

  @at-root #header-img.default-header {
    background-image: url($asset_logo);
    background-position: 0 center;
    background-size: contain;
    height: 205px;
    left: 0;
    position: absolute;
    text-indent: -9999px;
    top: 0;
    vertical-align: bottom;
    width: 189px;
    z-index: -1;
  }

  // The reddit name element is used for the logo.
  // An logo asset is used instead which should be changed at will, manually.
  > span.redditname {
    @include reset-box;
    margin: 0px;

    // We hide the text.
    font-size: 0px;

    > a {
      @include reset-box;

      background-image: url($asset_logo_sr);
      background-size: cover;
      height: 64px;
      width: 256px;

      display: none;
      @media only screen and (min-width: $respond-min-hgalign) {
        display: inline-block;
      }
    }
  }

  // Main tabmenu. On the listing page this contains (hot, new, rising...) buttons.
  // But they can contain any kind of buttons, RES will inject new as well.
  ul.tabmenu {
    position: absolute;
    display: block;
    background-color: transparent;
    top: $sidebar-top;
    right: $sidebar-width;
    // Leave room on the left for the filter button.
    // We place the filter button on the left so new buttons can be added here by RES.
    $base-left: ($tabmenu-tag-filter-btn-width + $tabmenu-cat-margin - $tabmenu-pad);
    height: $tabmenu-inner-height;
    margin: 0px;
    padding: $tabmenu-pad;

    // Gutter align unless screen is too small.
    left: $sidebar-padding + $base-left;
    @media only screen and (min-width: $respond-min-hgalign) {
      left: $left-gutter-width + $logoarea-gutter + $base-left;
    }

    // It's tempting to use overflow hidden here to prevent tabmenu content from leaking if too many
    // buttons is inserted (e.g. RES) and screen is too small, but this will break tooltips.
    // We need to prevent this in some other way...
    overflow: visible;

    // Required to prevent space between li to add extra margin.
    font-size: 0px;

    li {
      font-weight: normal;
      display: inline-block;
      margin: 0px $tabmenu-pad 0px 0px;
      text-transform: capitalize;
    }
    li a {
      @include btn-primary;
      @include btn-tabmenu-dim;
    }
    li.selected a {
      @extend a:active;
    }
    body.listing-page &, body.wiki-page & {
      li a {
        padding-left: 4px;
        padding-right: 4px;
      }
      // Wiki
      li:nth-child(7) {
        // Separate wiki button with 2 units of padding.
        margin-left: $tabmenu-cat-margin - $tabmenu-pad;
      }
      // Hide promoted, it's not like the admins allow any promoted links here anyway.
      li:nth-child(8) {
        display: none;
      }
    }
  }
}

// Move user box up into subreddit area to get it out of the way.
#header-bottom-right {
  @include reset-box;
  position: absolute;
  top: 0px;
  height: $srarea-height;
  padding: 0px 4px 0px 4px;
  @include reddit-srarea;
  a, span {
    @include reddit-srarea;
  }
  border-style: solid;
  border-width: 0px 0px 0px 1px;
  // In res the element is too fat to keep in top so we move it down to the left of the logo.
  &.res-navTop {
    right: $res-navtop-right;
    top: $srarea-height;

    .res-nightmode & {
      background-color: $color-focus-fg;

      #userbarToggle {
        background-color: $color-focus-fg;
      }
    }
  }
}

#RESPrefsDropdown {
  right: $res-navtop-right !important;
}

* {
  // Nuke modified letter spacing that makes text unreadable.
  letter-spacing: 0px !important;
}

input, textarea, keygen, select, button,  {
  font-family: $font-family;
}

input, textarea {
  font-size: 14px !important;
}

body {
  // Prevent absolute positioning from leaking to the window.
  position: relative;

  font-family: $font-family;
  font-size: $font-size-focus;
  line-height: normal;
  color: $color-focus-fg;

  // Background texture.
  background-image: url($asset_texture);
  background-repeat: repeat;
  background-color: #151515;
  background-size: 700px auto;

  .res-nightmode & {
    background-image: none;
    background-color: #000;
    color: nm_darken($color-focus-fill);
  }
}

div.side {
  margin: 0px;
  padding: $sidebar-padding;
  width: $sidebar-inner-width;
  @include focus-bg;
  font-size: $font-size-focus;
  float: right;

  @media only screen and (max-width: $respond-min-sidebar) {
    // Screen is too small for a visible sidebar.
    // Move the sidebar to the top and hide it with a vertical scroll.
    float: none;
    max-height: 250px;
    @include border-box;
    width: 100%;
    overflow-x: hidden;
    overflow-y: scroll;
  }

  // Remove ugly borders.
  .sidecontentbox .content {
    border-style: none;
  }

  // Remove ugly hr lines but keep them as separators.
  hr {
    background: transparent;
  }

  // Consistent headers with markdown.
  h1 {
    font-size: $side_header_font_size;
    color: $side_header_color;
  }

  // We utilize the first spacer to move sidebar into header since
  // this is a waste of space otherwise and it helps clip Vivian.
  // We can however only do this on screens that are large enough.
  @media only screen and (min-width: $respond-min-sidelvl) {
    &::before {
      display: block;
      @include focus-bg;
      $push-dist: $logoarea-height + $linkbar-height + $tabmenu-height;
      margin-bottom: -$push-dist + $sidebar-padding;
      margin-left: -$sidebar-padding;
      padding-left: $sidebar-padding;
      padding-right: $sidebar-padding;
      width: $sidebar-inner-width;
      height: $push-dist;
      content: '';
    }
  }

  // Style for sidebar spacers and the content inside those spacers.
  // The content of spacers varies depending on page/user etc and the order
  // cannot be trusted, but we try to list the style rules for spacers in
  // approximately the same order they usually appear in the sidebar for readability.
  div.spacer {
    // Make spacers insignificant so we can work with the content inside them.
    display: block;
    margin: 0;
    padding: 0;

    // Search.
    form#search {
      margin-bottom: $sidebar-padding;

      input[type=text] {
        border-radius: 10px;
        width: 100%;
        @include focus;
      }
      #searchexpando {
        @include focus-box;

        label:nth-of-type(2), label:nth-of-type(3) {
          display: none;
        }
      }

      // Move into header on larger screens.
      @media only screen and (min-width: $respond-min-sidelvl) {
        $search-width: 220px;
        position: absolute;
        width: $search-width;
        top: ($sidebar-top / 2) - 10px;
        right: ($sidebar-inner-width + $sidebar-padding - $search-width);
        padding-left: 20px;
        z-index: 10000;

        input[type=text] {
          width: $search-width;
        }
      }

      // Move search down slightly on res to avoid navtop collision.
      body.res & {
        margin-top: 5px;
      }
    }

    // We convert this to a nice button instead of ugly arrow.
    @at-root div.submit-link div.morelink {
      border-style: none;
      background-image: none;
      background-color: transparent;
      text-align: inherit;
      width: 100%;
      height: auto;
      margin-bottom: $sidebar-padding;

      a {
        @include btn-success;
        @include big-sidebar-btn;
        font-size: $font-size-btn;

        &::after {
          content: ' or post';
        }
      }
      div.nub {
        display: none;
      }
    }

    // RES stuff needs 1px padding to be perfect.
    div[data-res-css], .subButtons {
      padding-left: 1px;
    }

    .subButtons {
      html.res & {
        padding-top: .5em;
      }
    }

    .subscribers {
      html.res & {
        margin-top: 1em;
      }
    }

    // Hide text submit. We used combined button.
    div.submit-text {
      display: none;
    }

    // Link information in comment thread.
    div.linkinfo {
      @include focus-box;
      margin-bottom: $sidebar-padding;
      padding: $sidebar-padding;

      * {
        @include reset-text;
        font-size: $font-size-focus;
      }
      div.score {
        margin: $sidebar-padding 0px;
        span {
          font-size: $font-size-focus * 2;
        }
      }
      div.shortlink {
        font-size: 9px;
        input {
          font-size: $font-size-focus;
          border-width: 0px;
          background-color: transparent;
          padding: 0px;
        }
      }
    }

    // General sidebar content.
    > div.titlebox {
      h1.redditname {
        // Just takes up space. People know this is KotakuInAction.
        display: none;
      }
      // Subscribe button.
      @at-root span.subscribe-button.fancy-toggle-button {
        display: block;
        margin: 0px;
        margin-bottom: $sidebar-padding;

        > a.add, > a.remove {
          @include btn-primary;
          @include big-sidebar-btn;
          font-size: 0px;
        }

        > a.add {
          display: block;

          &::before {
            content: 'Subscribe to /r/KotakuInAction';
            font-size: $font-size-btn;
          }

          body.subscriber & {
            display: none;
          }
        }
        > a.remove {
          display: none;

          &::before {
            content: 'Unsubscribe from /r/KotakuInAction';
            font-size: $font-size-btn;
          }

          body.subscriber & {
            display: block;
          }
        }
      }
      // Subscribers counts.
      @at-root span.subscribers {
        @include font-focus;
        @include focus-box;
        display: block;
        padding: $sidebar-padding;
        margin: 0px;
        padding-bottom: 0px;
        border-bottom: 0px;
        span.number {
          body.subscriber &::before {
            display: inline-block;
            float: right;
            margin-bottom: $sidebar-padding;
            content: 'You’re a subscriber!';
          }
          &::after {
            content: ' ethical violations.';
          }
        }
        span.word {
          display: none;
        }
      }
      @at-root p.users-online {
        @include font-focus;
        @include focus-box;
        display: block;
        position: relative;
        padding: $sidebar-padding;
        margin: 0px;
        margin-bottom: $sidebar-padding;
        padding-top: 0px;
        border-top: 0px;
        &::before {
          // Hide ugly green circle.
          display: none;
        }
        span.number {
          &::after {
            content: ' navy sealions here, kiddo.';
          }
        }
        .word {
          display: none;
        }
      }
      // Entering custom sidebar markdown.
      form.usertext > div.usertext-body > div.md {
        margin-bottom: $sidebar-padding;
      }
      // Created by etc.
      div.bottom {
        @include reset-text;
        @include focus-box;
        font-size: $font-size-blur;
        margin-bottom: $sidebar-padding;
        padding: $sidebar-padding;
      }

      // Other sidebar junk and random HTML reddit injects where we just want to reset as much as possible
      // because it looks nasty. Hide ugly icons, etc.
      > div.leavemoderator, > form.leavecontributor-button, > form.flairtoggle {
        background-color: transparent;
        @include reset-text;
        @include font-blur;

        color: $color-focus-fg;
        font-size: $font-size-blur;
        padding: 0px $sidebar-padding;
        margin: 0px;
        margin-bottom: $sidebar-padding;
        &::before {
          display: none;
        }
      }
      // Flair configuration in a virtual box. These are two elements because someone at reddit.com should be fired.
      > form.flairtoggle {
        @include focus-box;
        font-size: $font-size-blur;
        padding: $sidebar-padding;
        margin: 0px;
        padding-bottom: 0px;
        border-bottom: 0px;

        + div.tagline {
          @include focus-box;
          overflow: hidden;
          padding: $sidebar-padding;
          border-top: 0px;
          display: block;
          margin: 0px;
          margin-bottom: $sidebar-padding;
        }
      }
    }

    // The second last sidebar content should always be "RECENTLY VIEWED LINKS".
    // Remove it as almost nobody is interested in it and it's just more clutter.
    &:nth-last-child(2) {
      display: none;
    }
  }

  // Style all sidecontent boxes focus boxes.
  div.sidecontentbox {
    @include focus-box;
    @include font-focus;
    padding: $sidebar-padding;
    margin-bottom: $sidebar-padding;

    // Style message moderators as a button.
    a.helplink[href^="/message/compose?to"] {
      @include btn-primary;
      @include big-sidebar-btn;
      margin: 0px;
      margin-bottom: $sidebar-padding;
      display: block;
      width: auto;
      float: none;
      font-size: 0px;

      &::before {
        content: 'Message the KiA Moderators';
        font-size: $font-size-btn;
      }
    }
  }

  // Compress moderation tools.
  div.sidecontentbox#moderation_tools {
    li {
      font-size: $font-size-blur;
      background-color: transparent;
      position: relative;
      a {
        @include btn-default;
        display: block;
        width: auto;
        text-align: left;
        margin-left: 30px;
        &::before {
          position: absolute;
          margin-right: -16px;
          left: 0px;
        }
      }

      img {
        display: none;
      }

      .toolbox-edit:before {
        background-image: url($asset_toolbox_edit);
        height: 16px;
        width: 16px;
        display: block;
        content: " ";
        float: left;
        margin-right: 5px;
      }
    }
  }

  div.account-activity-box {
    margin-bottom: $sidebar-padding;
  }

  // Hide create your own subreddit, not interesting to 99% of users.
  // There are plenty of ways to find this button.
  div.create {
    display: none;
  }
}

// Side markdown.
div.side div.md {
  @include font-focus;

  ul {
    padding-left: 20px;
  }

  h1 {
    font-size: $side_header_font_size;
    color: $side_header_color;
    margin-top: 10px;
    margin-bottom: 2px;
  }

  // Blockquotes on first level is used as boxes and should have no padding.
  > blockquote {
    padding: 0px;
  }

  // Hr's on first level is just used to separate blockquotes and should have no effect.
  > hr {
    margin: 0px;
    margin-bottom: $sidebar-padding;
  }

  // #1: FIRST BLOCKQUOTE with ul list is dropdown of filters.
  // Move the dropdown list to top bar next to 'wiki'.
  blockquote:nth-child(1) {
    @include reset-box;
    position: absolute;
    z-index: 10000;
    border: none;
    top: ($sidebar-top + $tabmenu-pad);
    width: $tabmenu-tag-filter-btn-width;

    // Gutter align unless screen is too small.
    left: $sidebar-padding;
    @media only screen and (min-width: $respond-min-hgalign) {
      left: $left-gutter-width + $logoarea-gutter;
    }

    ul {
      @include reset-box;

      &:hover > li {
        display: block;
      }
      > li {
        display: block;
      }
      > li:first-child {
        @include btn-primary;
        @include btn-tabmenu-dim;
        width: $tabmenu-tag-filter-btn-width;
        padding-left: 0px;
        padding-right: 0px;
      }
      > li + li {
        display: none;
        padding: 4px 5px;
        margin: 0px;
        width: 90%;
        border: 0px;
        -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
        -webkit-background-clip: padding-box;
        background-clip: padding-box;
        text-align: center;

        @include focus-fill;

        &:hover {
          @include focus-fill3;
        }
        a {
          @include link-flair-base;
          @include nm-low-opacity;
        }
        a[href$=uv] {
          @include std-link-flair($tag_color_unverified);
        }
        a[href$=ru] {
          @include std-link-flair($tag_color_rumor);
        }
        a[href$=vf] {
          @include std-link-flair($tag_color_verified);
        }
        a[href$=pe] {
          @include std-link-flair($tag_color_people);
        }
        a[href$=ha] {
          @include std-link-flair($tag_color_happenings);
        }
        a[href$=id] {
          @include std-link-flair($tag_color_ideas);
        }
        a[href$=bc] {
          @include std-link-flair($tag_color_goal);
        }
        a[href$=ed] {
          @include std-link-flair($tag_color_editorial);
        }
        a[href$=mt] {
          @include std-link-flair($tag_color_meta);
        }
        a[href$=dr] {
          @include std-link-flair($tag_color_drama);
        }
        a[href$=hu] {
          @include std-link-flair($tag_color_humor);
        }
        a[href$=st] {
          @include showerthought-flair;
        }
        a[href$=ds] {
          @include std-link-flair($tag_color_discussion);
        }
        a[href$=ot] {
          @include std-link-flair($tag_color_off_topic);
        }
        a[href$=et] {
          @include std-link-flair($tag_color_ethics);
        }
        a[href$=in] {
          @include std-link-flair($tag_color_industry);
        }
        a[href$=sj] {
          @include std-link-flair($tag_color_socjus);
          .res-nightmode & {
            color: black !important;
          }
        }
        a[href$=cs] {
          @include std-link-flair($tag_color_censorship);
        }

        .res-nightmode & {
          a {
            color: nm_darken($color-focus-fill) !important;
            opacity: 1;
          }
        }

      }
      > li:nth-child(2) {
        border-radius: 4px 4px 0px 0px;
        padding-top: 8px;
      }
      > li:last-child {
        border-radius: 0px 0px 4px 4px;
        padding-bottom: 8px;
      }
    }
  }

  // #2: Blockquote divider.
  hr:nth-child(2) {
    display: none;
  }

  // #3: Linkbar.
  blockquote:nth-child(3) {
    @include reset-box;
    @include reset-text;

    display: block;
    position: absolute;
    z-index: 1000;
    border: none;
    overflow: hidden;

    left: $left-gutter-width + $logoarea-gutter;
    height: $sidebar-top - $srarea-height;
    top: $srarea-height;

    // Don't cover subreddit logo if it's showing.
    @media only screen and (min-width: $respond-min-hgalign) {
      height: 34px;
      top: 75px;
    }

    h3 {
      display: inline-block;
      position: absolute;
      width: 100%;
      bottom: $sidebar-padding;

      @media only screen and (min-width: $respond-min-hgalign) {
        bottom: 0;
      }
    }

    // Gutter align unless screen is too small.
    right: 0px;
    @media only screen and (min-width: $respond-min-sidelvl) {
      right: $sidebar-width;
    }

    font-size: 11px;

    @include nm-low-opacity;

    a {
      color: #fff;
      font-weight: normal;
    }

    // Allow #new-highlight markers to draw attention to new links we want to "sticky".
    a[href$='#new-highlight'] {
      color: #5cff5c !important;
      text-decoration: underline;
    }
  }

  // #4: Blockquote divider.
  hr:nth-child(4) {
    display: none;
  }

  // Rest of blockquotes are focus box elements.
  blockquote:nth-child(n+5) {
    @include focus-box;
    margin: 0px;
    padding: $sidebar-padding;

    > *:first-child {
      margin-top: 0px;
    }
  }
}

div.content[role=main] {
  @include reset-box;
  @include focus-bg;
  padding: $sidebar-padding;
  z-index: 100;
  @include main-box-shadow;

  > div.commentarea {
    @include focus-box;

    // RES screws with child comment background color.
    .res-nightmode & {
      .comment {
        border-color: nm_darken(#666) !important;
      }
      .comment .comment {
        background-color: darken($color-focus-fill, 85%) !important;
      }

      .RES-keyNav-activeElement .md,
      .RES-keyNav-activeElement.entry .noncollapsed {
        background-color: transparent !important;
      }

      .new-comment .usertext-body {
        background-color: nm_darken(#666);
      }
    }

    .new-comment .usertext-body {
      margin: 5px 0;
      padding: 0 8px;
    }

    @at-root .comments-page {
      .entry .usertext-body > div.md, .usertext-body > div.md {
        font-size: 14px;
      }
    }
  }

  // Disable all framing for usertext body for cleaner look. Less is more.
  .link .usertext-body .md {
    border-style: none;
    border-radius: 0px;
    background-color: transparent;
    margin: 0px;
    padding: 0px;
  }

  .res-nightmode & .flair {
    background-color: transparent;
    border: 1px solid black;
    color: nm_darken($color-focus-fill);
  }

  > div#siteTable {
    > div.thing.even {
      @include focus-fill2
    }
    > div.thing {
      @include focus-box;
      padding: $sidebar-padding;
      margin: 0px;
      margin-bottom: -1px;
      /* limit width by right floating sidebar. */
      overflow: hidden;

      > .rank {
        // Hide link rank. For 99% of users this information is useless.
        display: none;
      }
      > .midcol {
        // We want to assign the midcol a width that aligns the right content with the left gutter.
        width: $left-gutter-width - $sidebar-padding;
        margin: 0px 0px 0px 0px;
        margin-left: -$sidebar-padding;

        > div {
          margin: auto;
        }
      }
      > div.entry {
        margin: 0px;
        > p.title {
          @include content-title;
        }
      }
    }
  }

  // Comment page.
  > div.commentarea {
    padding: $sidebar-padding;

    > * {
      margin-left: 0px;
    }

    > div.panestack-title {
      display: inline;
      border-style: none;
      margin: 0px;
      padding-right: 15px;
      span {
        @include font-focus;
      }
    }

    > div.menuarea {
      display: inline;
      margin: 0px;
      > *, form {
        display: inline;
      }
      .spacer {
        margin: 0px;
      }
      .dropdown {
        // Lol reddit bugfix.
        cursor: pointer;
      }
      span, a {
        @include font-focus;
      }
      a {
        text-decoration: underline;
      }
      + * {
        margin-top: $sidebar-padding;
      }
    }

    @at-root form.usertext {
      textarea {
        @include focus-box;
        @include form-field-box;
        background-image: url($asset_comment);
        background-repeat: no-repeat;
        background-size: auto 100px;
        background-position: bottom left;
        .res-nightmode & {
          background-image: url($asset_comment_nm);
        }
        &:focus {
          background-image: none !important;
        }
      }
      button.save {
        @include btn-primary;
        @include btn-sm;
      }
      button.cancel {
        @include btn-default;
        @include btn-sm;
      }
    }

    > .comment-visits-box {
      @include focus-box;
      background-color: $color-focus-fill2;
      border-radius: 0px;
    }

    > div.sitetable.nestedlisting > .thing {
      // More compact root comments.
      margin-left: 0px;
      .child {
        @include focus-box;
        border: 0px solid;
        border-left: 1px solid $color-focus-border;

        .res-nightmode & {
          border-color: nm_darken(#aaa);
        }

      }

      form.usertext {
        margin-bottom: $sidebar-padding;
      }
    }
  }

  // Submit page.
  body.submit-page & h1:first-child {
    display: none;
  }
  @at-root form.submit.content {
    @include reset-box;
    @include focus-box;
    padding: $sidebar-padding;
    overflow: hidden;

    ul.tabmenu {
      font-size: 0px;
      padding: 0px;
      a.choice {
        @include btn-primary;
      }
      li.selected a {
        @extend a:active;
      }
      a.link-button {
        font-size: 0px;
        &::before {
          content: 'Submit link';
          font-size: $font-size-btn;
        }
      }
      a.text-button {
        font-size: 0px;
        margin-left: $sidebar-padding;
        &::before {
          content: 'Text/self post';
          font-size: $font-size-btn;
        }
      }
    }
    div.spacer {
      @include reset-box;
      margin-bottom: $sidebar-padding;
      div, span {
        @include font-form-field;
      }
      #title-field, #url-field, #text-field, #reddit-field {
        span.title {
          font-weight: bold;
        }
      }
    }
    textarea, input[type=text], input[type=url] {
      @include focus-box;
      width: 100%;
      @include border-box;
      @include font-form-field;
      @include form-field-box;
    }
    div.infobar {
      @include reset-box;
    }
    div.roundfield {
      @include reset-box;

      div {
        @include reset-box;
      }
      div.roundfield-content {
        margin-top: 5px;
      }
    }
    span.title, span.gray, label {
      @include font-form-field;
    }
    // Remove suggested reddits, bloated distraction.
    div#suggested-reddits {
      display: none;
    }
    div#suggest-title button {
      @include btn-primary;
      @include btn-sm;
    }
    button[type=submit] {
      @include btn-success;
    }
    $submit-width: 600px;
    div.formtabs-content {
      margin-top: $sidebar-padding;
      border: 0px none transparent;
      padding: $sidebar-padding;
      margin-bottom: 0px;
      max-width: $submit-width;
      width: 100%;
      @include focus-box;
      @include focus-fill2;
      @include border-box;
      border-bottom-width: 0px;

      .spacer:first-child {
        &::after {
          @include font-form-field;
          content: 'When posting to /r/KotakuInAction: Your account MUST be older than 3 days. Please read the rules before posting. You can find the rules in the sidebar. Your post may be deleted automatically if it breaks one or more rules. When in doubt, message the moderators by using the button in the bottom of the sidebar.';
          display: block;
          margin: $sidebar-padding 0px;
        }
      }

      div.spacer:nth-of-type(2):before {
        content: 'Off-topic posts should be submitted as a Text/self post accompanied by a short description';
        font-weight: bold;
        text-transform: uppercase;
        font-size: 16px;
      }

      #title-field {
        margin-top: .5em;
      }

      // Remove pointless "options" title above checkbox.
      .spacer:last-child span.title {
        display: none;
      }

      + div.info-notice {
        display: block;
        @include font-form-field;
        @include reset-box;
        @include focus-box;
        @include focus-fill2;
        @include border-box;
        padding: $sidebar-padding;
        max-width: $submit-width;
        width: 100%;
        border-top-width: 0px;
        border-bottom-width: 0px;
        padding-top: 0px;

        &::before {
          @include nm-low-opacity;
        }

        + input[name=resubmit] + div.spacer {
          max-width: $submit-width;
          width: 100%;
          @include reset-box;
          @include focus-box;
          @include focus-fill2;
          @include border-box;
          padding: $sidebar-padding;
          display: block;
          border-top-width: 0px;
        }
      }
    }
  }
}

// Hide filter by tag and other buttons on submit page to remove distractions and optimize funnel to submit.
body.submit-page div.side div.usertext-body div.md blockquote:first-child {
  display: none;
}

// Footer
.footer-parent {

  @media only screen and (min-width: $respond-min-sidelvl) {
    // Vivian search picture.
    &::before {
      position: absolute;
      width: $sidebar-width;
      height: $sidebar-top;
      right: 0px;
      top: 0px;
      background-image: url($asset_vivian_search);
      background-size: $sidebar-top;
      background-repeat: no-repeat;
      background-position: bottom right;
      content: '';
      .res-nightmode & {
        background-image: url($asset_vivian_night);
      }
    }
  }

  // Tabmenu dark stripe.
  // Placed here because not all pages contain a tabmenu.
  &::after {
    position: absolute;
    display: block;
    background-color: #000;
    background-color: rgba(0, 0, 0, 0.3);
    top: $sidebar-top;
    right: 0px;
    left: $left-gutter-width + $logoarea-gutter - $tabmenu-pad;
    height: $tabmenu-height;
    margin: 0px;
    padding: 0px;
    content: '';
    z-index: -1;
    border-radius: 0px 0px 0px $sidebar-padding;
    .res-nightmode & {
      background-color: rgba(255, 255, 255, 0.1);
    }
  }

  .footer {
    @include main-box-shadow;
    @include reddit-site;
    margin-bottom: 50px;
    a, span {
      @include reddit-site;
    }

    div.col {
      @include blur;
    }
  }
}

body > p.debuginfo {
  &::before {
    position: absolute;
    display: block;
    right: 0px;
    left: 0px;
    bottom: -100px;
    height: 150px;
    background-image: url($asset-mars-top);
    background-position: top center;
    z-index: -10000;
    content: '';
    @include nm-opacity($nm-general-opacity / 2);
  }
  &::after {
    position: absolute;
    display: block;
    right: 0px;
    left: 0px;
    bottom: -350px;
    height: 250px;
    background-image: url($asset-mars-btm);
    background-position: top center;
    z-index: -10000;
    content: '';
    @include nm-opacity($nm-general-opacity / 2);
  }
}

// Header gradient. Absolute last position in document to only affect background texture.
body::after {
  content: ' ';
  position: absolute;
  top: 0px;
  left: 0px;
  right: 0px;
  height: $srarea-height;
  z-index: -10000;
  @include box-shadow(0px, 0px, 150px, 20px, rgba(0, 0, 0, 0.5));
}

// ********* HACKS. ********* //

// Hack that fix flair overflow in sidebar changing size of body on iphone.
div.side ul.content {
  overflow:hidden;
}

/* Special Flairs and Shit */
.commentarea .author:after{color:#0D0D0D}
.commentarea .author[href$="/user/TheHat2"]:after{content:" [Hatman]"}
